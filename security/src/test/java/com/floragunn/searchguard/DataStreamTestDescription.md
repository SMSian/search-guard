## Assumption:
according to https://git.floragunn.com/search-guard/search-guard-suite-enterprise/-/issues/114#note_16535 permissions should be assigned to backing indices.


1. Create data stream

   Seems like in order to create data stream, permission needs to be assigned to data stream, not to backing indices 
   - User with permissions `indices:admin/data_stream/create` assigned to `data-stream-first-*`

| description                                                                            | action                                             | result                                                                       | expected result                                                                                                     |
|----------------------------------------------------------------------------------------|----------------------------------------------------|------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------|
| given data stream does not exist, name matches pattern used to assign permission       | PUT /_data_stream/data-stream-first-test-create    | 200                                                                          | same as actual result (if in this case permission should be assigned to data stream, not to backing indices) or 403 |
| given data stream already exists, name matches pattern used to assign permission       | PUT /_data_stream/data-stream-first-already-exists | 400 "reason":"data_stream [data-stream-first-already-exists] already exists" | same as actual result (if in this case permission should be assigned to data stream, not to backing indices) or 403 |
| given data stream does not exist, name doesn't match pattern used to assign permission | PUT /_data_stream/something                        | 403  "missing_permissions":"something: indices:admin/data_stream/create"     | same as actual or 403 saying that user doesn't have permission to backing index                                     |
| given data stream exists, name doesn't match pattern used to assign permission         | PUT /_data_stream/data-stream-admin                | 400 "reason":"data_stream [data-stream-admin] already exists"                | 403 since user has no permissions to this data stream and it's backing indices                                      |


   - User with permissions `indices:admin/data_stream/create` assigned to `.ds-data-stream-second-*`

| description                                                                            | action                                              | result                                                                                       | expected result                                                                                                                                          |
|----------------------------------------------------------------------------------------|-----------------------------------------------------|----------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------|
| given data stream does not exist, name matches pattern used to assign permission       | PUT /_data_stream/data-stream-second-test-create    | 403 "missing_permissions":"data-stream-second-test-create: indices:admin/data_stream/create" | same as actual or 200 (if in this case permission should be assigned to backing indices)                                                                 |
| given data stream already exists, name matches pattern used to assign permission       | PUT /_data_stream/data-stream-second-already-exists | 400 "reason":"data_stream [data-stream-second-already-exists] already exists"                | 403 ((if in this case permission should be assigned to data stream) or same as actual (if in this case permission should be assigned to backing indices) |
| given data stream does not exist, name doesn't match pattern used to assign permission | PUT /_data_stream/something                         | 403  "missing_permissions":"something: indices:admin/data_stream/create"                     | same as actual or 403 saying that user doesn't have permission to backing index                                                                          |
| given data stream exists, name doesn't match pattern used to assign permission         | PUT /_data_stream/data-stream-admin                 | 400 "reason":"data_stream [data-stream-admin] already exists"                                | 403 since user has no permissions to this data stream and it's backing indices                                                                           |

2. Add doc to data stream
   - User with permissions `indices:data/write/index`, `indices:admin/mapping/auto_put`, `indices:admin/auto_create` assigned to `data-stream-first-*`

| description                                                                      | action                                                                                       | result                                                                                                                                                                                                                                                                                                                                                                                                                                                          | expected result                       |
|----------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|
| data stream exists, name matches pattern used to assign permission               | POST /data-stream-first-test-add-doc/_doc, POST /data-stream-first-test-add-doc/_create/<id> | 403 "missing_permissions":".ds-data-stream-first-test-add-doc-2023.04.21-000001: indices:data/write/index"                                                                                                                                                                                                                                                                                                                                                      | same as actual result                 |
| data stream does not exist, name matches pattern used to assign permission       | POST /data-stream-first-missing/_doc, POST /data-stream-first-missing/_create/<id>           | 403 "missing_permissions":".ds-data-stream-first-missing-2023.04.21-000001: **indices:admin/mapping/auto_put**" **or** "missing_permissions":".ds-data-stream-first-missing-2023.04.21-000001: **indices:data/write/index**". When we send request for the first time it returns missing: indices:admin/mapping/auto_put, but it seems like data stream is created anyway. When we send same request second time it returns: missing: indices:data/write/index. | 403 saying that user cannot create it |
| data stream exists, name doesn't match pattern used to assign permission         | POST /data-stream-admin/_doc, POST /data-stream-admin/_create/<id>                           | 403 "missing_permissions":".ds-data-stream-admin-2023.04.21-000001: indices:data/write/index"                                                                                                                                                                                                                                                                                                                                                                   | same as actual result                 |
| data stream does not exist, name doesn't match pattern used to assign permission | POST /not_existing/_doc, POST /not_existing/_create/<id>                                     | 403 "missing_permissions":"not_existing: indices:data/write/index"                                                                                                                                                                                                                                                                                                                                                                                              | same as actual result                 |

   - User with permissions `indices:data/write/index`, `indices:admin/mapping/auto_put`, `indices:admin/auto_create` assigned to `.ds-data-stream-second-*`

| description                                                                      | action                                                                                         | result                                                                                        | expected result                      |
|----------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------|--------------------------------------|
| data stream exists, name matches pattern used to assign permission               | POST /data-stream-second-test-add-doc/_doc, POST /data-stream-second-test-add-doc/_create/<id> | 201                                                                                           | same as actual result                |
| data stream does not exist, name matches pattern used to assign permission       | POST /data-stream-second-missing/_doc, POST /data-stream-second-missing/_create/<id>           | 403 "missing_permissions":"data-stream-second-missing: indices:data/write/index"              | 201 - data stream created, doc added |
| data stream exists, name doesn't match pattern used to assign permission         | POST /data-stream-admin/_doc, POST /data-stream-admin/_create/<id>                             | 403 "missing_permissions":".ds-data-stream-admin-2023.04.21-000001: indices:data/write/index" | same as actual result                |
| data stream does not exist, name doesn't match pattern used to assign permission | POST /not_existing/_doc, POST /not_existing/_create/<id>                                       | 403 "missing_permissions":"not_existing: indices:data/write/index"                            | same as actual result                |


3. Bulk add doc to data stream
   - User with permissions `indices:admin/mapping/auto_put`, `indices:admin/auto_create` assigned to `data-stream-first-*`, and cluster permission `indices:data/write/bulk`

| description                                                                      | action                                         | result                                                                                                                                                                            | expected result             |
|----------------------------------------------------------------------------------|------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|
| data stream exists, name matches pattern used to assign permission               | PUT /data-stream-first-test-add-doc-bulk/_bulk | 200 containing 403 errors in body, it returns 403 "missing_permissions":".ds-data-stream-first-test-add-doc-bulk-2023.04.21-000001: indices:admin/mapping/auto_put" for each item | 200 with 403 errors in body |
| data stream does not exist, name matches pattern used to assign permission       | PUT /data-stream-first-missing/_bulk           | 200 containing 403 errors in body, it returns 403 "missing_permissions":".ds-data-stream-first-missing-2023.04.21-000001: indices:admin/mapping/auto_put" for each item           | 200 with 403 errors in body |
| data stream exists, name doesn't match pattern used to assign permission         | PUT /data-stream-admin/_bulk                   | 200 containing 403 errors in body, it returns 403 "missing_permissions":".ds-data-stream-admin-2023.04.21-000001: indices:admin/mapping/auto_put" for each item                   | 200 with 403 errors in body |
| data stream does not exist, name doesn't match pattern used to assign permission | PUT /not_existing/_bulk                        | 200 containing 403 errors in body, it returns 403 "missing_permissions":"not_existing: indices:admin/auto_create" for each item                                                   | 200 with 403 errors in body |                                                                                                                                                                                                                                                                                                                                                                                             | 200 with 403 errors in body       |

   - User with permissions `indices:admin/mapping/auto_put`, `indices:admin/auto_create` assigned to `.ds-data-stream-second-*`, and cluster permission `indices:data/write/bulk`

| description                                                                      | action                                          | result                                                                                                                                                          | expected result                                                              |
|----------------------------------------------------------------------------------|-------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------|
| data stream exists, name matches pattern used to assign permission               | PUT /data-stream-second-test-add-doc-bulk/_bulk | 200 with 201 for each item in response body                                                                                                                     | same as actual result                                                        |
| data stream does not exist, name matches pattern used to assign permission       | PUT /data-stream-second-missing/_bulk           | 200 containing 403 errors in body, it returns 403 "missing_permissions":"data-stream-second-missing: indices:admin/auto_create" for each item                   | 200 with 201 in response body for each item, data stream created, docs added |
| data stream exists, name doesn't match pattern used to assign permission         | PUT /data-stream-admin/_bulk                    | 200 containing 403 errors in body, it returns 403 "missing_permissions":".ds-data-stream-admin-2023.04.21-000001: indices:admin/mapping/auto_put" for each item | 200 with 403 errors in body                                                  |
| data stream does not exist, name doesn't match pattern used to assign permission | PUT /not_existing/_bulk                         | 200 containing 403 errors in body, it returns 403 "missing_permissions":"not_existing: indices:admin/auto_create" for each item                                 | 200 with 403 errors in body                                                  |                                                                                                                                                                                                                                                                                                                                                                                             | 200 with 403 errors in body       |


4. Get data stream
   - User with permissions `indices:admin/data_stream/get` assigned to `data-stream-first-*`

| description                                                                                  | action                                           | result                                                                                                      | expected result                                                                                                                                     |
|----------------------------------------------------------------------------------------------|--------------------------------------------------|-------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|
| get all                                                                                      | GET /_data_stream                                | 200 with empty list                                                                                         | same as actual result                                                                                                                               | 
| get by name, data stream exists, name matches pattern used to assign permission              | GET /_data_stream/data-stream-first-test-get     | 403 "missing_permissions":".ds-data-stream-first-test-get-2023.04.21-000001: indices:admin/data_stream/get" | same as actual result                                                                                                                               | 
| get by name, data stream doesn't exist, name matches pattern used to assign permission       | GET /_data_stream/data-stream-first-not_existing | 404 "reason":"no such index [data-stream-first-not_existing]                                                | same as actual or 403 if we can determine that user wants to access data stream not index                                                           | 
| get by name, data stream exists, name doesn't match pattern used to assign permission        | GET /_data_stream/data-stream-admin              | 403 "missing_permissions":".ds-data-stream-admin-2023.04.21-000001: indices:admin/data_stream/get"          | same as actual result                                                                                                                               | 
| get by name, data stream doesn't exist, name doesn't match pattern used to assign permission | GET /_data_stream/not_existing                   | 403 "missing_permissions":"not_existing: indices:admin/data_stream/get"                                     | same as actual or 403 saying that user doesn't have permission to backing index if we can determine that user wants to access data stream not index | 
| get by prefix, matching data stream exists                                                   | GET /_data_stream/data-stream-first-*            | 200 with empty list                                                                                         | same as actual result                                                                                                                               | 
| get by prefix, matching data stream doesn't exists                                           | GET /_data_stream/data-stream-first-fake*        | 200 with empty list                                                                                         | same as actual result                                                                                                                               | 
| get by prefix, matching data stream exists                                                   | GET /_data_stream/data-stream-*                  | 200 with empty list                                                                                         | same as actual result                                                                                                                               | 
| get by prefix, matching data stream doesn't exists                                           | GET /_data_stream/data-stream-fake*              | 200 with empty list                                                                                         | same as actual result                                                                                                                               | 
| get by prefix, matching data stream exists                                                   | GET /_data_stream/data-stream-admin*             | 200 with empty list                                                                                         | same as actual result                                                                                                                               | 
| get by prefix, matching data stream doesn't exists                                           | GET /_data_stream/data-stream-adminfake*         | 200 with empty list                                                                                         | same as actual result                                                                                                                               | 

   - User with permissions `indices:admin/data_stream/get` assigned to `.ds-data-stream-second-*`

| description                                                                                  | action                                            | result                                                                                             | expected result                                                                                                                                     |
|----------------------------------------------------------------------------------------------|---------------------------------------------------|----------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|
| get all                                                                                      | GET /_data_stream                                 | 200 with empty list                                                                                | 200 with list containing data stream that user can access                                                                                           | 
| get by name, data stream exists, name matches pattern used to assign permission              | GET /_data_stream/data-stream-second-test-get     | 200 with list containing one data stream                                                           | same as actual result                                                                                                                               | 
| get by name, data stream doesn't exist, name matches pattern used to assign permission       | GET /_data_stream/data-stream-second-not_existing | 403 "missing_permissions":"data-stream-second-not_existing: indices:admin/data_stream/get"         | same as actual or 404 saying that data stream was not found if we can determine that user wants to access data stream not index                     | 
| get by name, data stream exists, name doesn't match pattern used to assign permission        | GET /_data_stream/data-stream-admin               | 403 "missing_permissions":".ds-data-stream-admin-2023.04.21-000001: indices:admin/data_stream/get" | same as actual result                                                                                                                               | 
| get by name, data stream doesn't exist, name doesn't match pattern used to assign permission | GET /_data_stream/not_existing                    | 403 "missing_permissions":"not_existing: indices:admin/data_stream/get"                            | same as actual or 403 saying that user doesn't have permission to backing index if we can determine that user wants to access data stream not index | 
| get by prefix, matching data stream exists                                                   | GET /_data_stream/data-stream-second-*            | 200 with list containing data stream that user can access                                          | same as actual result                                                                                                                               | 
| get by prefix, matching data stream doesn't exists                                           | GET /_data_stream/data-stream-second-fake*        | 200 with empty list                                                                                | same as actual result                                                                                                                               | 
| get by prefix, matching data stream exists                                                   | GET /_data_stream/data-stream-*                   | 200 with empty list                                                                                | 200 with list containing data stream that user can access                                                                                           | 
| get by prefix, matching data stream doesn't exists                                           | GET /_data_stream/data-stream-fake*               | 200 with empty list                                                                                | same as actual result                                                                                                                               | 
| get by prefix, matching data stream exists                                                   | GET /_data_stream/data-stream-admin*              | 200 with empty list                                                                                | same as actual result                                                                                                                               | 
| get by prefix, matching data stream doesn't exists                                           | GET /_data_stream/data-stream-adminfake*          | 200 with empty list                                                                                | same as actual result                                                                                                                               | 


5. Delete data stream
   - User with permissions `indices:admin/data_stream/delete` assigned to `data-stream-first-*`

| description                                                                                     | action                                                             | result                                                                                                              | expected result                                                                                                                                     |
|-------------------------------------------------------------------------------------------------|--------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|
| delete by name, data stream exists, name matches pattern used to assign permission              | DELETE /_data_stream/data-stream-first-test-delete-1               | 403 "missing_permissions":".ds-data-stream-first-test-delete-1-2023.04.21-000001: indices:admin/data_stream/delete" | same as actual result                                                                                                                               | 
| delete by name, data stream doesn't exist, name matches pattern used to assign permission       | DELETE /_data_stream/data-stream-first-not_existing                | 404 "reason":"no such index [data-stream-first-not_existing]                                                        | same as actual or 403 (if we can determine that user wants to access data stream not index)                                                         | 
| delete by name, data stream exists, name doesn't match pattern used to assign permission        | DELETE /_data_stream/data-stream-admin                             | 403 "missing_permissions":".ds-data-stream-admin-2023.04.21-000001: indices:admin/data_stream/delete"               | same as actual result                                                                                                                               | 
| delete by name, data stream doesn't exist, name doesn't match pattern used to assign permission | DELETE /_data_stream/not_existing                                  | 403 "missing_permissions":"not_existing: indices:admin/data_stream/delete"                                          | same as actual or 403 saying that user doesn't have permission to backing index if we can determine that user wants to access data stream not index | 
| delete by prefix, matching data stream exists                                                   | DELETE /_data_stream/_data_stream/data-stream-first-test-delete-2* | 403 "missing_permissions":".ds-data-stream-first-test-delete-2-2023.04.21-000001: indices:admin/data_stream/delete" | 200 (ignore data streams that user cannot access) or same as actual result?                                                                         | 
| delete by prefix, matching data stream doesn't exists                                           | DELETE /_data_stream/data-stream-first-fake*                       | 200                                                                                                                 | 200 or 403?                                                                                                                                         | 
| delete by prefix, matching data stream exists                                                   | DELETE /_data_stream/data-stream-*                                 | 403 "missing_permissions": [array containing backing indices names that user cannot access]                         | 200 (ignore data streams that user cannot access) or same as actual result?                                                                         | 
| delete by prefix, matching data stream doesn't exists                                           | DELETE /_data_stream/data-stream-*fake                             | 200                                                                                                                 | 200 or 403?                                                                                                                                         | 
| delete by prefix, matching data stream exists                                                   | DELETE /_data_stream/data-stream-admin*                            | 403 "missing_permissions":".ds-data-stream-admin-2023.04.21-000001: indices:admin/data_stream/delete"               | 200 or same as actual result?                                                                                                                       | 
| delete by prefix, matching data stream doesn't exists                                           | DELETE /_data_stream/fake*                                         | 200                                                                                                                 | 200 (ignore data streams that user cannot access) or 403?                                                                                           | 

   - User with permissions `indices:admin/data_stream/delete` assigned to `.ds-data-stream-second-*`

| description                                                                                     | action                                                              | result                                                                                                | expected result                                                                                                                                     |
|-------------------------------------------------------------------------------------------------|---------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|
| delete by name, data stream exists, name matches pattern used to assign permission              | DELETE /_data_stream/data-stream-second-test-delete-1               | 200                                                                                                   | same as actual result                                                                                                                               | 
| delete by name, data stream doesn't exist, name matches pattern used to assign permission       | DELETE /_data_stream/data-stream-second-not_existing                | 403 "missing_permissions":"data-stream-second-not_existing: indices:admin/data_stream/delete"         | same as actual or 404 saying that data stream was not found if we can determine that user wants to access data stream not index                     | 
| delete by name, data stream exists, name doesn't match pattern used to assign permission        | DELETE /_data_stream/data-stream-admin                              | 403 "missing_permissions":".ds-data-stream-admin-2023.04.21-000001: indices:admin/data_stream/delete" | same as actual result                                                                                                                               | 
| delete by name, data stream doesn't exist, name doesn't match pattern used to assign permission | DELETE /_data_stream/not_existing                                   | 403 "missing_permissions":"not_existing: indices:admin/data_stream/delete"                            | same as actual or 403 saying that user doesn't have permission to backing index if we can determine that user wants to access data stream not index | 
| delete by prefix, matching data stream exists                                                   | DELETE /_data_stream/_data_stream/data-stream-second-test-delete-2* | 200                                                                                                   | same as actual result                                                                                                                               | 
| delete by prefix, matching data stream doesn't exists                                           | DELETE /_data_stream/data-stream-second-fake*                       | 200                                                                                                   | same as actual result                                                                                                                               | 
| delete by prefix, matching data stream exists                                                   | DELETE /_data_stream/data-stream-*                                  | 403 "missing_permissions": [array containing backing indices names that user cannot access]           | same as actual or 200 (ignore data streams that user cannot access)                                                                                 | 
| delete by prefix, matching data stream doesn't exists                                           | DELETE /_data_stream/data-stream-*fake                              | 200                                                                                                   | same as actual result or 403 (data streams that user cannot access may exist)                                                                       | 
| delete by prefix, matching data stream exists                                                   | DELETE /_data_stream/data-stream-admin*                             | 403 "missing_permissions":".ds-data-stream-admin-2023.04.21-000001: indices:admin/data_stream/delete" | same as actual result or 200 (ignore data streams that user cannot access)                                                                          | 
| delete by prefix, matching data stream doesn't exists                                           | DELETE /_data_stream/fake*                                          | 200                                                                                                   | same as actual result or 403                                                                                                                        | 

6. Search data stream
   - User with permissions `indices:data/read/search` assigned to `data-stream-shared*`

| description                                                                                  | action                               | result                                                                                         | expected result                                                             |
|----------------------------------------------------------------------------------------------|--------------------------------------|------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------|
| get all                                                                                      | GET /_search                         | 200 with empty list of hits                                                                    | same as actual result                                                       | 
| get by name, data stream exists, name matches pattern used to assign permission              | GET /data-stream-shared/_search      | 403 "missing_permissions":".ds-data-stream-shared-2023.04.21-000001: indices:data/read/search" | same as actual result                                                       | 
| get by name, data stream doesn't exist, name matches pattern used to assign permission       | GET /data-stream-sharedfake/_search  | 404 "reason":"no such index [data-stream-sharedfake]"                                          | I think 404 is ok since user has permission assigned to data-stream-shared* | 
| get by name, data stream exists, name doesn't match pattern used to assign permission        | GET /data-stream-admin/_search       | 403 "missing_permissions":".ds-data-stream-admin-2023.04.21-000001: indices:data/read/search"  | same as actual result                                                       | 
| get by name, data stream doesn't exist, name doesn't match pattern used to assign permission | GET /not_existing/_search            | 403 "missing_permissions":"not_existing: indices:data/read/search"                             | same as actual result                                                       | 
| get by prefix, matching data stream exists                                                   | GET /data-stream-shared*/_search     | 200 with empty list of hits                                                                    | same as actual result                                                       | 
| get by prefix, matching data stream doesn't exists                                           | GET /data-stream-sharedfake*/_search | 200 with empty list of hits                                                                    | same as actual result                                                       | 
| get by prefix, matching data stream exists                                                   | GET /data-stream-*/_search           | 200 with empty list of hits                                                                    | same as actual result                                                       | 
| get by prefix, matching data stream doesn't exists                                           | GET /data-stream-*fake/_search       | 200 with empty list of hits                                                                    | same as actual result                                                       | 
| get by prefix, matching data stream exists                                                   | GET /data-stream-admin*/_search      | 200 with empty list of hits                                                                    | same as actual result                                                       | 
| get by prefix, matching data stream doesn't exists                                           | GET /data-stream-adminfake*/_search  | 200 with empty list of hits                                                                    | same as actual result                                                       | 

- User with permissions `indices:admin/data_stream/get` assigned to `.ds-data-stream-shared*`

| description                                                                                  | action                               | result                                                                                        | expected result                                                                                                |
|----------------------------------------------------------------------------------------------|--------------------------------------|-----------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------|
| get all                                                                                      | GET /_search                         | 200 with list of hits containing only docs from shared data stream                            | same as actual result                                                                                          | 
| get by name, data stream exists, name matches pattern used to assign permission              | GET /data-stream-shared/_search      | 200 with list of hits containing only docs from shared data stream                            | same as actual result                                                                                          | 
| get by name, data stream doesn't exist, name matches pattern used to assign permission       | GET /data-stream-sharedfake/_search  | 403 "missing_permissions":"data-stream-sharedfake: indices:data/read/search"                  | I think 403 is ok since user has permission assigned to backing indices, and given data stream does not exist? | 
| get by name, data stream exists, name doesn't match pattern used to assign permission        | GET /data-stream-admin/_search       | 403 "missing_permissions":".ds-data-stream-admin-2023.04.21-000001: indices:data/read/search" | same as actual result                                                                                          | 
| get by name, data stream doesn't exist, name doesn't match pattern used to assign permission | GET /not_existing/_search            | 403 "missing_permissions":"not_existing: indices:data/read/search"                            | I think 403 is ok since user has permission assigned to backing indices, and given data stream does not exist? | 
| get by prefix, matching data stream exists                                                   | GET /data-stream-shared*/_search     | 200 with list of hits containing only docs from shared data stream                            | same as actual result                                                                                          | 
| get by prefix, matching data stream doesn't exists                                           | GET /data-stream-sharedfake*/_search | 200 with empty list of hits                                                                   | same as actual result                                                                                          | 
| get by prefix, matching data stream exists                                                   | GET /data-stream-*/_search           | 200 with list of hits containing only docs from shared data stream                            | same as actual result                                                                                          | 
| get by prefix, matching data stream doesn't exists                                           | GET /data-stream-*fake/_search       | 200 with empty list of hits                                                                   | same as actual result                                                                                          | 
| get by prefix, matching data stream exists                                                   | GET /data-stream-admin*/_search      | 200 with empty list of hits                                                                   | same as actual result                                                                                          | 
| get by prefix, matching data stream doesn't exists                                           | GET /data-stream-adminfake*/_search  | 200 with empty list of hits                                                                   | same as actual result                                                                                          | 

7. Data stream field capabilities
   - User with permissions `indices:data/read/field_caps` assigned to `data-stream-shared*`

| description                                                                                  | action                                                                  | result                                                                                             | expected result                                                             |
|----------------------------------------------------------------------------------------------|-------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------|
| get all                                                                                      | GET /_field_caps?fields=@timestamp                                      | 200 with empty lists of fields & indices                                                           | same as actual result                                                       | 
| get by name, data stream exists, name matches pattern used to assign permission              | GET /data-stream-shared/_field_caps?fields=@timestamp                   | 403 "missing_permissions":".ds-data-stream-shared-2023.04.21-000001: indices:data/read/field_caps" | same as actual result                                                       | 
| get by name, data stream doesn't exist, name matches pattern used to assign permission       | GET /data-stream-sharedfake/_field_caps?fields=@timestamp               | 404 "reason":"no such index [data-stream-sharedfake]"                                              | I think 404 is ok since user has permission assigned to data-stream-shared* | 
| get by name, data stream exists, name doesn't match pattern used to assign permission        | GET /_data_stream/data-stream-admin/_field_caps?fields=@timestamp       | 403 "missing_permissions":".ds-data-stream-admin-2023.04.21-000001: indices:data/read/field_caps"  | same as actual result                                                       | 
| get by name, data stream doesn't exist, name doesn't match pattern used to assign permission | GET /_data_stream/not_existing/_field_caps?fields=@timestamp            | 403 "missing_permissions":"not_existing: indices:data/read/field_caps"                             | same as actual result                                                       | 
| get by prefix, matching data stream exists                                                   | GET /_data_stream/data-stream-shared*/_field_caps?fields=@timestamp     | 200 with empty lists of fields & indices                                                           | same as actual result                                                       | 
| get by prefix, matching data stream doesn't exists                                           | GET /_data_stream/data-stream-sharedfake*/_field_caps?fields=@timestamp | 200 with empty lists of fields & indices                                                           | same as actual result                                                       | 
| get by prefix, matching data stream exists                                                   | GET /_data_stream/data-stream-*/_field_caps?fields=@timestamp           | 200 with empty lists of fields & indices                                                           | same as actual result                                                       | 
| get by prefix, matching data stream doesn't exists                                           | GET /_data_stream/data-stream-*fake/_field_caps?fields=@timestamp       | 200 with empty lists of fields & indices                                                           | same as actual result                                                       | 
| get by prefix, matching data stream exists                                                   | GET /_data_stream/data-stream-admin*/_field_caps?fields=@timestamp      | 200 with empty lists of fields & indices                                                           | same as actual result                                                       | 
| get by prefix, matching data stream doesn't exists                                           | GET /_data_stream/data-stream-adminfake*/_field_caps?fields=@timestamp  | 200 with empty lists of fields & indices                                                           | same as actual result                                                       | 

   - User with permissions `indices:data/read/field_caps` assigned to `.ds-data-stream-shared*`

| description                                                                                  | action                                                                  | result                                                                                                  | expected result                                                                                                |
|----------------------------------------------------------------------------------------------|-------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------|
| get all                                                                                      | GET /_field_caps?fields=@timestamp                                      | 200 with list containing selected field & list containing indices starting with .ds-data-stream-shared  | same as actual result                                                                                          | 
| get by name, data stream exists, name matches pattern used to assign permission              | GET /data-stream-shared/_field_caps?fields=@timestamp                   | 200 with list containing selected field & list containing one index which belongs to shared data stream | same as actual result                                                                                          | 
| get by name, data stream doesn't exist, name matches pattern used to assign permission       | GET /data-stream-sharedfake/_field_caps?fields=@timestamp               | 403 "missing_permissions":"data-stream-sharedfake: indices:data/read/field_caps"                        | I think 403 is ok since user has permission assigned to backing indices, and given data stream does not exist? | 
| get by name, data stream exists, name doesn't match pattern used to assign permission        | GET /_data_stream/data-stream-admin/_field_caps?fields=@timestamp       | 403 "missing_permissions":".ds-data-stream-admin-2023.04.21-000001: indices:data/read/field_caps"       | same as actual result                                                                                          | 
| get by name, data stream doesn't exist, name doesn't match pattern used to assign permission | GET /_data_stream/not_existing/_field_caps?fields=@timestamp            | 403 "missing_permissions":"not_existing: indices:data/read/field_caps"                                  | same as actual result                                                                                          | 
| get by prefix, matching data stream exists                                                   | GET /_data_stream/data-stream-shared*/_field_caps?fields=@timestamp     | 200 with list containing selected field & list containing one index which belongs to shared data stream | same as actual result                                                                                          | 
| get by prefix, matching data stream doesn't exists                                           | GET /_data_stream/data-stream-sharedfake*/_field_caps?fields=@timestamp | 200 with empty lists of fields & indices                                                                | same as actual result                                                                                          | 
| get by prefix, matching data stream exists                                                   | GET /_data_stream/data-stream-*/_field_caps?fields=@timestamp           | 200 with list containing selected field & list containing indices starting with .ds-data-stream-shared  | same as actual result                                                                                          | 
| get by prefix, matching data stream doesn't exists                                           | GET /_data_stream/data-stream-*fake/_field_caps?fields=@timestamp       | 200 with empty lists of fields & indices                                                                | same as actual result                                                                                          | 
| get by prefix, matching data stream exists                                                   | GET /_data_stream/data-stream-admin*/_field_caps?fields=@timestamp      | 200 with empty lists of fields & indices                                                                | same as actual result                                                                                          | 
| get by prefix, matching data stream doesn't exists                                           | GET /_data_stream/data-stream-adminfake*/_field_caps?fields=@timestamp  | 200 with empty lists of fields & indices                                                                | same as actual result                                                                                          | 

8. Get data stream stats
   - User with permissions `indices:monitor/data_stream/stats` assigned to `data-stream-shared*`

| description                                                                                  | action                                           | result                                                                                                  | expected result                                                                                                                                                                                                              |
|----------------------------------------------------------------------------------------------|--------------------------------------------------|---------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| get all                                                                                      | GET /_data_stream/_stats                         | 403 "missing_permissions": [array containing backing indices names that user cannot access]             | 200 with empty list of data streams? indices:monitor/data_stream/stats may be added to AuthorizationConfig (DEFAULT_IGNORE_UNAUTHORIZED_INDICES_ACTIONS, DEFAULT_IGNORE_UNAUTHORIZED_INDICES_ACTIONS_ALLOWING_EMPTY_RESULT)? | 
| get by name, data stream exists, name matches pattern used to assign permission              | GET /_data_stream/data-stream-shared/_stats      | 403 "missing_permissions":".ds-data-stream-shared-2023.04.24-000001: indices:monitor/data_stream/stats" | same as actual result                                                                                                                                                                                                        | 
| get by name, data stream doesn't exist, name matches pattern used to assign permission       | GET /_data_stream/data-stream-sharedfake/_stats  | 404 "reason":"no such index [data-stream-sharedfake]                                                    | same as actual result or 403 if we can determine that user wants to access data stream not index                                                                                                                             | 
| get by name, data stream exists, name doesn't match pattern used to assign permission        | GET /_data_stream/data-stream-admin/_stats       | 403 "missing_permissions":".ds-data-stream-admin-2023.04.24-000001: indices:monitor/data_stream/stats"  | same as actual result                                                                                                                                                                                                        | 
| get by name, data stream doesn't exist, name doesn't match pattern used to assign permission | GET /_data_stream/not_existing/_stats            | 403 "missing_permissions":"not_existing: indices:monitor/data_stream/stats"                             | same as actual or 403 saying that user doesn't have permission to backing index if we can determine that user wants to access data stream not index                                                                          | 
| get by prefix, matching data stream exists                                                   | GET /_data_stream/data-stream-shared*/_stats     | 403 "missing_permissions":".ds-data-stream-shared-2023.04.24-000001: indices:monitor/data_stream/stats" | 200 with empty list of data streams? indices:monitor/data_stream/stats may be added to AuthorizationConfig (DEFAULT_IGNORE_UNAUTHORIZED_INDICES_ACTIONS, DEFAULT_IGNORE_UNAUTHORIZED_INDICES_ACTIONS_ALLOWING_EMPTY_RESULT)? | 
| get by prefix, matching data stream doesn't exists                                           | GET /_data_stream/data-stream-sharedfake*/_stats | 200 with empty list of data streams                                                                     | same as actual result                                                                                                                                                                                                        | 
| get by prefix, matching data stream exists                                                   | GET /_data_stream/data-stream-*/_stats           | 403 "missing_permissions": [array containing backing indices names that user cannot access]             | 200 with empty list of data streams? indices:monitor/data_stream/stats may be added to AuthorizationConfig (DEFAULT_IGNORE_UNAUTHORIZED_INDICES_ACTIONS, DEFAULT_IGNORE_UNAUTHORIZED_INDICES_ACTIONS_ALLOWING_EMPTY_RESULT)? | 
| get by prefix, matching data stream doesn't exists                                           | GET /_data_stream/data-stream-*fake/_stats       | 200 with empty list of data streams                                                                     | same as actual result                                                                                                                                                                                                        | 
| get by prefix, matching data stream exists                                                   | GET /_data_stream/data-stream-admin*/_stats      | 403 "missing_permissions":".ds-data-stream-admin-2023.04.24-000001: indices:monitor/data_stream/stats"  | 200 with empty list of data streams? indices:monitor/data_stream/stats may be added to AuthorizationConfig (DEFAULT_IGNORE_UNAUTHORIZED_INDICES_ACTIONS, DEFAULT_IGNORE_UNAUTHORIZED_INDICES_ACTIONS_ALLOWING_EMPTY_RESULT)? | 
| get by prefix, matching data stream doesn't exists                                           | GET /_data_stream/data-stream-adminfake*/_stats  | 200 with empty list of data streams                                                                     | same as actual result                                                                                                                                                                                                        | 

   - User with permissions `indices:monitor/data_stream/stats` assigned to `.ds-data-stream-shared*`

| description                                                                                  | action                                           | result                                                                                                 | expected result                                                                                                                                                                                                                                                 |
|----------------------------------------------------------------------------------------------|--------------------------------------------------|--------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| get all                                                                                      | GET /_data_stream/_stats                         | 403 "missing_permissions":".ds-data-stream-admin-2023.04.24-000001: indices:monitor/data_stream/stats" | 200 with list containing data streams starting with data-stream-shared? indices:monitor/data_stream/stats may be added to AuthorizationConfig (DEFAULT_IGNORE_UNAUTHORIZED_INDICES_ACTIONS, DEFAULT_IGNORE_UNAUTHORIZED_INDICES_ACTIONS_ALLOWING_EMPTY_RESULT)? | 
| get by name, data stream exists, name matches pattern used to assign permission              | GET /_data_stream/data-stream-shared/_stats      | 200 with list containing one data stream                                                               | same as actual result                                                                                                                                                                                                                                           | 
| get by name, data stream doesn't exist, name matches pattern used to assign permission       | GET /_data_stream/data-stream-sharedfake/_stats  | 403 "missing_permissions":"data-stream-sharedfake: indices:monitor/data_stream/stats"                  | same as actual or 404 if we can determine that user wants to access data stream not index                                                                                                                                                                       | 
| get by name, data stream exists, name doesn't match pattern used to assign permission        | GET /_data_stream/data-stream-admin/_stats       | 403 "missing_permissions":".ds-data-stream-admin-2023.04.24-000001: indices:monitor/data_stream/stats" | same as actual result                                                                                                                                                                                                                                           | 
| get by name, data stream doesn't exist, name doesn't match pattern used to assign permission | GET /_data_stream/not_existing/_stats            | 403 "missing_permissions":"not_existing: indices:monitor/data_stream/stats"                            | same as actual or 403 saying that user doesn't have permission to backing index if we can determine that user wants to access data stream not index                                                                                                             | 
| get by prefix, matching data stream exists                                                   | GET /_data_stream/data-stream-shared*/_stats     | 200 with list containing one data stream                                                               | same as actual result                                                                                                                                                                                                                                           | 
| get by prefix, matching data stream doesn't exists                                           | GET /_data_stream/data-stream-sharedfake*/_stats | 200 with empty list of data streams                                                                    | same as actual result                                                                                                                                                                                                                                           | 
| get by prefix, matching data stream exists                                                   | GET /_data_stream/data-stream-*/_stats           | 403 "missing_permissions":".ds-data-stream-admin-2023.04.24-000001: indices:monitor/data_stream/stats" | 200 with list containing data streams starting with data-stream-shared? indices:monitor/data_stream/stats may be added to AuthorizationConfig (DEFAULT_IGNORE_UNAUTHORIZED_INDICES_ACTIONS, DEFAULT_IGNORE_UNAUTHORIZED_INDICES_ACTIONS_ALLOWING_EMPTY_RESULT)? | 
| get by prefix, matching data stream doesn't exists                                           | GET /_data_stream/data-stream-*fake/_stats       | 200 with empty list of data streams                                                                    | same as actual result                                                                                                                                                                                                                                           | 
| get by prefix, matching data stream exists                                                   | GET /_data_stream/data-stream-admin*/_stats      | 403 "missing_permissions":".ds-data-stream-admin-2023.04.24-000001: indices:monitor/data_stream/stats" | 200 with empty list of data streams? indices:monitor/data_stream/stats may be added to AuthorizationConfig (DEFAULT_IGNORE_UNAUTHORIZED_INDICES_ACTIONS, DEFAULT_IGNORE_UNAUTHORIZED_INDICES_ACTIONS_ALLOWING_EMPTY_RESULT)?                                    | 
| get by prefix, matching data stream doesn't exists                                           | GET /_data_stream/data-stream-adminfake*/_stats  | 200 with empty list of data streams                                                                    | same as actual result                                                                                                                                                                                                                                           | 

9. Rollover data stream
   - User with permissions `indices:admin/rollover` assigned to `data-stream-first-*`

| description                                                                      | action                                          | result                                                                                                    | expected result                                                                                                                                                                                    |
|----------------------------------------------------------------------------------|-------------------------------------------------|-----------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| data stream exists, name matches pattern used to assign permission               | POST /data-stream-first-test-rollover/_rollover | 403 "missing_permissions":".ds-data-stream-first-test-rollover-2023.04.24-000001: indices:admin/rollover" | same as actual result                                                                                                                                                                              |
| data stream does not exist, name matches pattern used to assign permission       | POST /data-stream-first-fake/_rollover          | 404 "reason":"no such index [data-stream-first-fake]                                                      | I think 404 is ok since data stream with this name doesn't exist, user has permission assigned to data stream, and this endpoint may handle  indices and data streams?                             |
| data stream exists, name doesn't match pattern used to assign permission         | POST /data-stream-admin/_rollover               | 403 "missing_permissions":".ds-data-stream-admin-2023.04.24-000001: indices:admin/rollover"               | same as actual result                                                                                                                                                                              |
| data stream does not exist, name doesn't match pattern used to assign permission | POST /not_existing/_rollover                    | 403 "missing_permissions":"not_existing: indices:admin/rollover"                                          | I think 403 is ok since data stream with this name doesn't exist, user has permission assigned to data stream with different name pattern, and this endpoint may handle  indices and data streams? |

   - User with permissions `indices:admin/rollover` assigned to `.ds-data-stream-second-*`

| description                                                                      | action                                           | result                                                                                      | expected result                                                                                                                                                                                        |
|----------------------------------------------------------------------------------|--------------------------------------------------|---------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| data stream exists, name matches pattern used to assign permission               | POST /data-stream-second-test-rollover/_rollover | 404 "reason":"no such index [.force_no_index*]                                              | 200                                                                                                                                                                                                    |
| data stream does not exist, name matches pattern used to assign permission       | POST /data-stream-second-fake/_rollover          | 403 "missing_permissions":"data-stream-second-fake: indices:admin/rollover"                 | I think 403 is ok since data stream with this name doesn't exist, user has permission assigned to backing indices with different name pattern, and this endpoint may handle  indices and data streams? |
| data stream exists, name doesn't match pattern used to assign permission         | POST /data-stream-admin/_rollover                | 403 "missing_permissions":".ds-data-stream-admin-2023.04.24-000001: indices:admin/rollover" | same as actual result                                                                                                                                                                                  |
| data stream does not exist, name doesn't match pattern used to assign permission | POST /not_existing/_rollover                     | 403 "missing_permissions":"not_existing: indices:admin/rollover"                            | same as actual result                                                                                                                                                                                  |


10. Reindex data stream
   - User with permissions `indices:admin/auto_create` assigned to `data-stream-first-*`, `indices:data/read/search` assigned to `data-stream-shared*`, and cluster permission `indices:data/write/reindex`

| description                                                                                  | action                                                                                             | result                                                                                         | expected result       |
|----------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------|-----------------------|
| source data stream exists, dest name matches pattern used to assign permission               | POST /_reindex {source: data-stream-shared, dest: data-stream-first-reindex-UUID.randomUUID()}     | 403 "missing_permissions":".ds-data-stream-shared-2023.04.24-000001: indices:data/read/search" | same as actual result |
| source data stream does not exist, dest name matches pattern used to assign permission       | POST /_reindex {source: data-stream-sharedfake, dest: data-stream-first-reindex-UUID.randomUUID()} | 404 "reason":"no such index [data-stream-sharedfake]                                           | same as actual result |
| source data stream exists, dest name doesn't match pattern used to assign permission         | POST /_reindex {source: data-stream-shared, dest: fake-reindex-UUID.randomUUID()}                  | 403 "missing_permissions":".ds-data-stream-shared-2023.04.24-000001: indices:data/read/search" | same as actual result |
| source data stream does not exist, dest name doesn't match pattern used to assign permission | POST /_reindex {source: data-stream-sharedfake, dest: fake-reindex-UUID.randomUUID()}              | 404 "reason":"no such index [data-stream-sharedfake]                                           | same as actual result |
| source data stream exists, dest name matches pattern used to assign permission               | POST /_reindex {source: data-stream-admin, dest: data-stream-first-reindex-UUID.randomUUID()}      | 403 "missing_permissions":".ds-data-stream-admin-2023.04.24-000001: indices:data/read/search"  | same as actual result |
| source data stream does not exist, dest name matches pattern used to assign permission       | POST /_reindex {source: data-stream-adminfake, dest: data-stream-first-reindex-UUID.randomUUID()}  | 404 "reason":"no such index [data-stream-admin fake]                                           | same as actual result |                                                                                                                                     |

   - User with permissions `indices:admin/auto_create` assigned to `.ds-data-stream-second-*`, `indices:data/read/search` assigned to `.ds-data-stream-shared*`, and cluster permission `indices:data/write/reindex`

| description                                                                                  | action                                                                                              | result                                                                                                                 | expected result       |
|----------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------|-----------------------|
| source data stream exists, dest name matches pattern used to assign permission               | POST /_reindex {source: data-stream-shared, dest: data-stream-second-reindex-UUID.randomUUID()}     | 403 "missing_permissions":"data-stream-second-reindex-049800c6-e9db-4637-9f94-43ea0b7ef2ba: indices:admin/auto_create" | 200                   |
| source data stream does not exist, dest name matches pattern used to assign permission       | POST /_reindex {source: data-stream-sharedfake, dest: data-stream-second-reindex-UUID.randomUUID()} | 404 "reason":"no such index [data-stream-sharedfake]                                                                   | same as actual result |
| source data stream exists, dest name doesn't match pattern used to assign permission         | POST /_reindex {source: data-stream-shared, dest: fake-reindex-UUID.randomUUID()}                   | 403 "missing_permissions":"fake-reindex-9cad6966-65d0-4ee4-9d31-3b027fc8d7bc: indices:admin/auto_create"               | same as actual result |
| source data stream does not exist, dest name doesn't match pattern used to assign permission | POST /_reindex {source: data-stream-sharedfake, dest: fake-reindex-UUID.randomUUID()}               | 404 "reason":"no such index [data-stream-sharedfake]                                                                   | same as actual result |
| source data stream exists, dest name matches pattern used to assign permission               | POST /_reindex {source: data-stream-admin, dest: data-stream-second-reindex-UUID.randomUUID()}      | 403 "missing_permissions":".ds-data-stream-admin-2023.04.24-000001: indices:data/read/search"                          | same as actual result |
| source data stream does not exist, dest name matches pattern used to assign permission       | POST /_reindex {source: data-stream-adminfake, dest: data-stream-second-reindex-UUID.randomUUID()}  | 404 "reason":"no such index [data-stream-adminfake]                                                                    | same as actual result |

11. Open closed backing indices
   - User with permissions `indices:admin/open` assigned to `data-stream-first-*`

| description                                                                      | action                                            | result                                                                                                      | expected result                                                                                                                                                       |
|----------------------------------------------------------------------------------|---------------------------------------------------|-------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| data stream exists, name matches pattern used to assign permission               | POST /data-stream-first-open-closed-indices/_open | 403 "missing_permissions":".ds-data-stream-first-open-closed-indices-2023.04.24-000001: indices:admin/open" | same as actual result                                                                                                                                                 |
| data stream does not exist, name matches pattern used to assign permission       | POST /data-stream-first-fake/_open                | 404 "no such index [data-stream-first-fake]                                                                 | I think 404 is ok since data stream with this name doesn't exist, user has permission assigned to data stream, and this endpoint may handle indices and data streams? |
| data stream exists, name doesn't match pattern used to assign permission         | POST /data-stream-admin/_open                     | 403 "missing_permissions":".ds-data-stream-admin-2023.04.24-000001: indices:admin/open"                     | same as actual result                                                                                                                                                 |
| data stream does not exist, name doesn't match pattern used to assign permission | POST /data-stream-adminfake/_open                 | 403 "missing_permissions":"data-stream-adminfake: indices:admin/open"                                       | same as actual result                                                                                                                                                 |

   - User with permissions `indices:admin/open` assigned to `.ds-data-stream-second-*`

| description                                                                      | action                                             | result                                                                                  | expected result                                                                                                                                                                                       |
|----------------------------------------------------------------------------------|----------------------------------------------------|-----------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| data stream exists, name matches pattern used to assign permission               | POST /data-stream-second-open-closed-indices/_open | 200                                                                                     | same as actual result                                                                                                                                                                                 |
| data stream does not exist, name matches pattern used to assign permission       | POST /data-stream-second-fake/_open                | 403 "missing_permissions":"data-stream-second-fake: indices:admin/open"                 | I think 403 is ok since data stream with this name doesn't exist, user has permission assigned to backing indices with different name pattern, and this endpoint may handle indices and data streams? |
| data stream exists, name doesn't match pattern used to assign permission         | POST /data-stream-admin/_open                      | 403 "missing_permissions":".ds-data-stream-admin-2023.04.24-000001: indices:admin/open" | same as actual result                                                                                                                                                                                 |
| data stream does not exist, name doesn't match pattern used to assign permission | POST /data-stream-adminfake/_open                  | 403 "missing_permissions":"data-stream-adminfake: indices:admin/open"                   | same as actual result                                                                                                                                                                                 |

12. Migrate index alias to data stream
- User with permissions `indices:admin/data_stream/migrate` assigned to `ds-index-*`

| description                                                                                                                                                        | action                                                                                        | result                                                                                                                                              | expected result                                                                                                  |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------|
| alias exists, name matches name of data stream to which user has permissions, index: ds-index-test-migrate-UUID.randomUUID(), user has access to write index       | POST /_data_stream/_migrate/data-stream-second-test-index-alias-migrate-UUID.randomUUID()     | 200                                                                                                                                                 | same as actual result                                                                                            |
| alias doesn't exist, name matches name of data stream to which user has permissions                                                                                | POST /_data_stream/_migrate/data-stream-second-test-index-alias-migrate-UUID.randomUUID()fake | 403 "missing_permissions":"data-stream-second-test-index-alias-migrate-f81823fe-8e9c-4a5c-82f7-1a5290d4f1d3fake: indices:admin/data_stream/migrate" | same as actual result or 404 if we can determine that user wants to access data stream not index                 |
| alias exists, name matches name of data stream to which user has permissions, index: index-test-migrate-UUID.randomUUID(), user has no access to write index       | POST /_data_stream/_migrate/data-stream-second-test-index-alias-migrate-UUID.randomUUID()     | 403 "missing_permissions":"index-test-migrate-54ad9f81-bd6b-4a68-aa55-26bf9ae7de11: indices:admin/data_stream/migrate"                              | same as actual result                                                                                            |
| alias exists, name doesn't match name of data stream to which user has permissions, index: ds-index-test-migrate-UUID.randomUUID(), user has access to write index | POST /_data_stream/_migrate/data-stream-first-test-index-alias-migrate-UUID.randomUUID()      | 200                                                                                                                                                 | 403? - user has no access to data streams with given name (it creates data stream with same name as index alias) |

13. Modify data stream
- User with permissions `indices:admin/data_stream/modify` assigned to `ds-index-*`

| description                                                    | action                                                                                                                                                 | result                                                                                                                            | expected result                               |
|----------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|
| data stream & index exist, user has access to both             | POST /_data_stream/_modify {add_backing_index: {data stream: data-stream-second-test-modify, index: ds-index-UUID.randomUUID()}}                       | 200                                                                                                                               | same as actual result                         |
| only data stream exists, user has access to both               | POST /_data_stream/_modify {add_backing_index: {data stream: data-stream-second-test-modify, index: ds-index-fake-UUID.randomUUID()}}                  | 400 "reason":"index [ds-index-fake-c492e959-3842-499a-9973-158660bf0bf6] not found"                                               | same as actual result                         |
| only index exists, user has access to both                     | POST /_data_stream/_modify {add_backing_index: {data stream: data-stream-second-test-modify-fake, index: ds-index-UUID.randomUUID()}}                  | 400 "reason":"data stream [data-stream-second-test-modify-fake] not found"                                                        | same as actual result                         |
| data stream & index exist, user has access only to data stream | POST /_data_stream/_modify {add_backing_index: {data stream: data-stream-second-test-modify, index: index-which-user-cannot-access-UUID.randomUUID()}} | 403 "missing_permissions":"index-which-user-cannot-access-d5e2c8f9-2735-4e5a-8bec-b493dbc5280f: indices:admin/data_stream/modify" | same as actual result                         |
| data stream & index exist, user has access only to index       | POST /_data_stream/_modify {add_backing_index: {data stream: data-stream-admin, index: ds-index-UUID.randomUUID()}}                                    | 200                                                                                                                               | 403? - user has no access to this data stream |